

<html>
<head>
	<title>Conteo Nocturno de Platos</title>
	<style>
		body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: #f4f8f3; }
		.container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 24px #0001; padding: 32px 40px; }
		h1 { color: #2d4a22; margin-bottom: 8px; }
		.subtitle { color: #4e6b4a; margin-bottom: 30px; }
		.categoria { margin-top: 32px; font-size: 1.2em; color: #1a2e13; font-weight: bold; border-bottom: 1px solid #e0e0e0; padding-bottom: 4px; }
		table { width: 100%; border-collapse: collapse; margin-top: 10px; }
		th, td { padding: 8px 6px; text-align: left; }
		th { background: #eaf3e6; color: #2d4a22; }
		tr:nth-child(even) { background: #f7faf6; }
		.input-cantidad { width: 60px; border: 1px solid #b2c7b0; border-radius: 4px; padding: 4px; }
		#resumen { background: #f7faf6; border: 1px solid #b2c7b0; padding: 18px; margin-top: 30px; border-radius: 8px; }
		.btns { margin-top: 24px; display: flex; gap: 16px; }
		button { padding: 10px 24px; background: #2d4a22; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; transition: background 0.2s; }
		button:hover { background: #3e6b32; }
		@media (max-width: 700px) {
			.container { padding: 12px 2vw; }
			table, th, td { font-size: 0.95em; }
		}
	</style>
</head>
<body>
	<div id="loginContainer" style="max-width:400px;margin:80px auto 0 auto;padding:32px 24px;background:#fff;border-radius:12px;box-shadow:0 4px 24px #0001;display:block;">
		<h2 style="color:#2d4a22;text-align:center;">Acceso al Sistema</h2>
		<div style="margin:18px 0 10px 0;text-align:center;">Ingrese la contrase√±a para continuar</div>
		<input id="passwordInput" type="password" placeholder="Contrase√±a" style="width:100%;padding:10px 8px;border-radius:6px;border:1px solid #b2c7b0;font-size:1.1em;">
		<button onclick="login()" style="width:100%;margin-top:18px;padding:10px 0;background:#2d4a22;color:#fff;border:none;border-radius:6px;font-size:1.1em;cursor:pointer;">Entrar</button>
		<div id="loginError" style="color:#b00;margin-top:10px;text-align:center;display:none;">Contrase√±a incorrecta</div>
	</div>
	<div class="container" id="mainContainer" style="display:none;">
		<div id="fraseMotivadora" style="background:#eaf3e6; color:#2d4a22; border-radius:8px; padding:16px 18px; margin-bottom:24px; font-size:1.15em; font-weight:bold; text-align:center;"></div>
		<h1>Conteo Nocturno de Platos</h1>
		<div class="subtitle">Ingresa la cantidad vendida de cada plato. Puedes exportar el resumen a Excel/CSV/PDF, imprimir, y ver gr√°ficas.</div>
		<div style="display:flex;gap:16px;align-items:center;margin-bottom:18px;flex-wrap:wrap;">
			<div style="flex:1;min-width:220px;">
				<label for="categoriaSelect" style="font-weight:bold;">Secci√≥n:</label>
				<select id="categoriaSelect" onchange="renderForm()" style="margin-left:10px; padding:4px 10px; border-radius:4px; border:1px solid #b2c7b0;">
					<!-- Opciones generadas por JS -->
				</select>
			</div>
			<div style="flex:1;min-width:220px;">
				<label for="usuarioInput" style="font-weight:bold;">Usuario:</label>
				<input id="usuarioInput" type="text" placeholder="Nombre del responsable" style="margin-left:10px; padding:4px 10px; border-radius:4px; border:1px solid #b2c7b0;">
			</div>
			<div style="flex:2;min-width:220px;">
				<label for="buscadorPlato" style="font-weight:bold;">Buscar plato:</label>
				<input id="buscadorPlato" type="text" placeholder="Filtrar por nombre..." style="margin-left:10px; padding:4px 10px; border-radius:4px; border:1px solid #b2c7b0;" oninput="renderForm()">
			</div>
			<div style="flex:0;min-width:120px;">
				<button type="button" onclick="toggleDarkMode()" style="padding:6px 16px;">üåô Modo oscuro</button>
			</div>
		</div>
		<form id="conteoForm">
			<!-- CATEGOR√çAS Y PLATOS -->
		</form>
		<div style="margin:18px 0 8px 0;">
			<label for="notasDia" style="font-weight:bold;">Notas del d√≠a:</label>
			<textarea id="notasDia" rows="2" style="width:100%;margin-top:6px;padding:8px 10px;border-radius:6px;border:1px solid #b2c7b0;"></textarea>
		</div>
		<div class="btns">
			<button type="button" onclick="mostrarResumen()">Ver Resumen</button>
			<button type="button" onclick="exportarCSV()">Exportar a Excel/CSV</button>
			<button type="button" onclick="exportarPDF()">Exportar a PDF</button>
			<button type="button" onclick="window.print()">Imprimir</button>
			<button type="button" onclick="abrirMenuEditor()">Editar Men√∫</button>
		</div>
		<div id="resumen"></div>
		<div id="grafica" style="margin-top:32px;"></div>
		<div id="menuEditorModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0008;z-index:1000;align-items:center;justify-content:center;">
			<div id="menuEditorBg" onclick="cerrarMenuEditor()" style="position:absolute;top:0;left:0;width:100vw;height:100vh;"></div>
			<div style="background:#fff;padding:32px 24px;border-radius:12px;max-width:500px;width:95vw;position:relative;z-index:2;box-shadow:0 4px 24px #0003;max-height:80vh;overflow-y:auto;">
				<h2>Editar Men√∫</h2>
				<div id="menuEditorContent"></div>
				<button onclick="guardarMenuEditado()" style="margin-top:18px;">Guardar cambios</button>
				<button onclick="cerrarMenuEditor()" style="margin-top:18px;margin-left:10px;">Cancelar</button>
			</div>
		</div>
	</div>
	<script>
	// Modo oscuro
	function toggleDarkMode() {
		document.body.classList.toggle('dark-mode');
	}

	// Men√∫ editable (estructura b√°sica)
	function abrirMenuEditor() {
		let html = '';
		menu.forEach((cat, cidx) => {
			html += `<div style='font-weight:bold;margin-top:18px;'>${cat.cat}</div>`;
			cat.items.forEach((item, iidx) => {
				html += `<div style='display:flex;gap:8px;margin-bottom:6px;'><input type='text' value='${item.n}' data-cidx='${cidx}' data-iidx='${iidx}' style='flex:1;padding:4px 8px;border-radius:4px;border:1px solid #b2c7b0;'><button onclick='eliminarPlato(${cidx},${iidx})' type='button'>Eliminar</button></div>`;
			});
			html += `<button onclick='agregarPlato(${cidx})' type='button' style='margin-bottom:10px;'>Agregar plato</button>`;
		});
		document.getElementById('menuEditorContent').innerHTML = html;
		document.getElementById('menuEditorModal').style.display = 'flex';
		// Evitar que el scroll de la p√°gina se mueva cuando el modal est√° abierto
		document.body.style.overflow = 'hidden';
	}
	function cerrarMenuEditor() {
		document.getElementById('menuEditorModal').style.display = 'none';
		document.body.style.overflow = '';
	}
	function agregarPlato(cidx) {
		menu[cidx].items.push({n:'Nuevo plato'});
		abrirMenuEditor();
	}
	function eliminarPlato(cidx, iidx) {
		menu[cidx].items.splice(iidx,1);
		abrirMenuEditor();
	}
	function guardarMenuEditado() {
		const inputs = document.querySelectorAll('#menuEditorContent input[type=text]');
		inputs.forEach(input => {
			const cidx = parseInt(input.getAttribute('data-cidx'));
			const iidx = parseInt(input.getAttribute('data-iidx'));
			menu[cidx].items[iidx].n = input.value;
		});
		cerrarMenuEditor();
		renderCategoriaSelect();
		renderForm();
	}

	// Buscador de platos
	function getPlatosFiltrados(catIdx) {
		const filtro = document.getElementById('buscadorPlato').value.toLowerCase();
		if (!filtro) return menu[catIdx].items;
		return menu[catIdx].items.filter(item => item.n.toLowerCase().includes(filtro));
	}
	// Contrase√±a simple (puedes cambiarla aqu√≠)
	const PASSWORD = "montana2025";

	function login() {
		const input = document.getElementById('passwordInput');
		const error = document.getElementById('loginError');
		if (input.value === PASSWORD) {
			document.getElementById('loginContainer').style.display = 'none';
			document.getElementById('mainContainer').style.display = 'block';
		} else {
			error.style.display = 'block';
		}
	}
	document.getElementById('passwordInput').addEventListener('keydown', function(e) {
		if (e.key === 'Enter') login();
	});

	// Frases motivadoras (50)
	const frases = [
		"Hoy es un gran d√≠a para dar lo mejor de ti.",
		"Cada plato servido es una oportunidad para sorprender.",
		"La pasi√≥n por lo que haces se nota en cada detalle.",
		"El √©xito es la suma de peque√±os esfuerzos repetidos cada d√≠a.",
		"Sonr√≠e, tu actitud transforma el ambiente.",
		"La excelencia se logra con constancia.",
		"Un cliente feliz es la mejor recompensa.",
		"Hoy puedes superar tus propios l√≠mites.",
		"La amabilidad es el mejor ingrediente.",
		"Hazlo con amor y se notar√° en el resultado.",
		"Cada d√≠a es una nueva oportunidad para brillar.",
		"El trabajo en equipo hace posible lo imposible.",
		"La calidad comienza con la atenci√≥n al detalle.",
		"Tu esfuerzo marca la diferencia.",
		"La mejor saz√≥n es la dedicaci√≥n.",
		"Hoy puedes inspirar a quienes te rodean.",
		"La actitud positiva es contagiosa.",
		"El respeto y la cortes√≠a abren puertas.",
		"La creatividad transforma lo cotidiano en especial.",
		"Cada cliente merece lo mejor de nosotros.",
		"El aprendizaje nunca termina.",
		"La humildad es la base del crecimiento.",
		"El compromiso se refleja en el servicio.",
		"La gratitud convierte lo que tenemos en suficiente.",
		"Hoy es un buen d√≠a para aprender algo nuevo.",
		"La perseverancia vence cualquier obst√°culo.",
		"El entusiasmo es el motor del √©xito.",
		"La honestidad es el mejor aderezo.",
		"La confianza se gana con cada acci√≥n.",
		"El respeto por el cliente es nuestra prioridad.",
		"La limpieza es parte del buen servicio.",
		"La puntualidad habla de tu profesionalismo.",
		"La empat√≠a crea conexiones duraderas.",
		"El optimismo abre caminos.",
		"La paciencia es clave en los momentos dif√≠ciles.",
		"La innovaci√≥n nos mantiene vigentes.",
		"El orden facilita el trabajo.",
		"La cortes√≠a nunca pasa de moda.",
		"La pasi√≥n se transmite en cada plato.",
		"El respeto entre compa√±eros fortalece el equipo.",
		"La actitud de servicio es nuestro sello.",
		"La comunicaci√≥n es la base del √©xito.",
		"La responsabilidad es nuestro compromiso.",
		"La superaci√≥n personal es un camino diario.",
		"La motivaci√≥n es el primer paso para lograrlo.",
		"La honestidad genera confianza.",
		"La dedicaci√≥n es la clave del reconocimiento.",
		"La amabilidad abre corazones.",
		"La pasi√≥n por servir nos distingue.",
		"Hoy es el mejor d√≠a para dar lo mejor de ti."
	];

	// Mostrar frase motivadora seg√∫n el d√≠a
	function mostrarFraseMotivadora() {
		const hoy = new Date();
		// D√≠a √∫nico desde una fecha base (por ejemplo, 2025-01-01)
		const base = new Date(2025, 0, 1);
		const dias = Math.floor((hoy - base) / (1000 * 60 * 60 * 24));
		const idx = dias % frases.length;
		document.getElementById('fraseMotivadora').textContent = frases[idx];
	}

	// Men√∫ con precios
	const menu = [
		{cat:'üç≥ Desayunos / Cenas', items:[
			{n:'Omelette supremo'},
			{n:'Popt√∫n finquero'},
			{n:'Omelette jam√≥n y queso'},
			{n:'Desayuno de la casa'},
			{n:'Huevos gratinados a la Monta√±a'},
			{n:'Chilaquiles Monta√±a'},
			{n:'Panqueques'},
			{n:'Tostadas francesas'},
			{n:'Wafles'},
			{n:'Ensalada de frutas'},
			{n:'Copa del rey'},
			{n:'Huevos ahogados'},
			{n:'Huevos al alba√±il'},
			{n:'Desayuno/cena (2 huevos al gusto, frijol, pl√°tano, tortilla, caf√©)'},
		]},
		{cat:'ü•© Asados Monta√±a (incluyen 3 guarniciones)', items:[
			{n:'Tomahawk 1LB'},
			{n:'Ribeye steak 1LB'},
			{n:'Cowboy steak 1LB'},
			{n:'Puyazo ¬Ω LB'},
			{n:'Lomito ¬Ω LB'},
			{n:'Costilla asada ¬Ω LB'},
			{n:'Costilla en BBQ ¬Ω LB'},
			{n:'Pierna cuadril'},
			{n:'Pollo asado'},
			{n:'Caldo de res'},
			{n:'Churrasco de res (8 onz carne, arroz, frijol, chirmol)'},
			{n:'Caldo de res (especial)'},
			{n:'Pollo asado pierna cuadril'},
		]},
		{cat:'üêü Mariscos', items:[
			{n:'Mojarra frita'},
			{n:'Camarones 1LB'},
		]},
		{cat:'üçù Pastas', items:[
			{n:'Pasta Alfredo con camar√≥n'},
			{n:'Lasa√±a de res'},
			{n:'Espagueti a la bolo√±esa'},
		]},
		{cat:'üåÆ Snacks Monta√±a', items:[
			{n:'Tacos de res (4 con costra de queso)'},
			{n:'Tacos de birria'},
			{n:'Tacos de cochinilla'},
			{n:'S√°ndwich cl√°sico'},
			{n:'S√°ndwich de pollo'},
			{n:'Hamburguesa Steak'},
			{n:'Nachos supremos'},
			{n:'S√°ndwich jam√≥n y queso'},
		]},
		{cat:'üç∞ Postres', items:[
			{n:'Crepas (Nutella / Fresa / Banano gratinado)'},
			{n:'Mosaico de la casa'},
			{n:'Pera horneada al vino con helado'},
			{n:'Copa de helado con galletas'},
		]},
		{cat:'ü•§ Bebidas Fr√≠as', items:[
			{n:'Pichel de horchata'},
			{n:'Pichel de jamaica'},
			{n:'Smoothie (fresa/banano/mixto)'},
			{n:'Frappe (Caramelo/Fresa/Oreo/Caf√©)'},
			{n:'Gaseosa'},
			{n:'Naranjada con soda/agua'},
			{n:'Limonada con soda/agua'},
			{n:'Agua pura'},
			{n:'Jugo verde'},
		]},
		{cat:'‚òï Bebidas Calientes', items:[
			{n:'Caf√© con leche'},
			{n:'Chocolate (agua/leche)'},
			{n:'T√©'},
		]},
		{cat:'üçπ Bebidas Preparadas', items:[
			{n:'Cerveza Gallo'},
			{n:'Sangr√≠a'},
			{n:'Pi√±a colada'},
			{n:'Mojito cubano'},
			{n:'Margarita'},
			{n:'Daiquiri (cl√°sico o fresa)'},
			{n:'Cimarrona'},
		]},
	];


	// Renderizar opciones del selector de categor√≠a
	function renderCategoriaSelect() {
		const select = document.getElementById('categoriaSelect');
		select.innerHTML = '';
		menu.forEach((cat, idx) => {
			const opt = document.createElement('option');
			opt.value = idx;
			opt.textContent = cat.cat;
			select.appendChild(opt);
		});
	}

	// Renderizar el formulario solo para la categor√≠a seleccionada
	function renderForm() {
		const select = document.getElementById('categoriaSelect');
		const idx = select ? parseInt(select.value) : 0;
		let html = '';
		if (menu[idx]) {
			html += `<div class='categoria'>${menu[idx].cat}</div><table><tr><th>Plato</th><th>Cantidad</th></tr>`;
			getPlatosFiltrados(idx).forEach(item => {
				html += `<tr><td>${item.n}</td><td><input class='input-cantidad' type='number' min='0' name="${item.n}" /></td></tr>`;
			});
			html += '</table>';
		}
		document.getElementById('conteoForm').innerHTML = html;
	}

	// Inicializar selector, formulario y frase motivadora
	renderCategoriaSelect();
	renderForm();
	mostrarFraseMotivadora();


	function mostrarResumen() {
		const select = document.getElementById('categoriaSelect');
		const idx = select ? parseInt(select.value) : 0;
		const form = document.getElementById('conteoForm');
		const data = new FormData(form);
		const usuario = document.getElementById('usuarioInput').value;
		const notas = document.getElementById('notasDia').value;
		let resumen = `<h2>Resumen del Conteo</h2><div style='font-weight:bold;margin-bottom:8px;'>${menu[idx].cat}</div>`;
		if(usuario) resumen += `<div><b>Usuario:</b> ${usuario}</div>`;
		if(notas) resumen += `<div><b>Notas:</b> ${notas}</div>`;
		let hayDatos = false;
		resumen += '<table><tr><th>Plato</th><th>Cantidad</th></tr>';
		let datosGrafica = [];
		menu[idx].items.forEach(item => {
			let cantidad = data.get(item.n);
			if (cantidad && parseInt(cantidad) > 0) {
				resumen += `<tr><td>${item.n}</td><td>${cantidad}</td></tr>`;
				datosGrafica.push({plato: item.n, cantidad: parseInt(cantidad)});
				hayDatos = true;
			}
		});
		resumen += '</table>';
		if (!hayDatos) {
			resumen = '<p>No se ingresaron cantidades.</p>';
			document.getElementById('grafica').innerHTML = '';
		} else {
			mostrarGrafica(datosGrafica);
		}
		document.getElementById('resumen').innerHTML = resumen;
	}

	// Gr√°fica de barras simple
	function mostrarGrafica(datos) {
		if (!datos.length) { document.getElementById('grafica').innerHTML = ''; return; }
		let max = Math.max(...datos.map(d=>d.cantidad));
		let html = `<h3>Gr√°fica de Platos Vendidos</h3><div style='display:flex;flex-direction:column;gap:8px;'>`;
		datos.sort((a,b)=>b.cantidad-a.cantidad).forEach(d => {
			let ancho = max ? (d.cantidad/max*100) : 0;
			html += `<div style='display:flex;align-items:center;gap:8px;'><div style='width:220px;'>${d.plato}</div><div style='background:#4e6b4a;height:22px;width:${ancho}%;min-width:20px;border-radius:4px;color:#fff;display:flex;align-items:center;justify-content:center;'>${d.cantidad}</div></div>`;
		});
		html += '</div>';
		document.getElementById('grafica').innerHTML = html;
	}

	function exportarCSV() {
		const select = document.getElementById('categoriaSelect');
		const idx = select ? parseInt(select.value) : 0;
		const form = document.getElementById('conteoForm');
		const data = new FormData(form);
		const usuario = document.getElementById('usuarioInput').value;
		const notas = document.getElementById('notasDia').value;
		let rows = [[menu[idx].cat], ['Usuario', usuario], ['Notas', notas], ['Plato','Cantidad']];
		let hayDatos = false;
		menu[idx].items.forEach(item => {
			let cantidad = data.get(item.n);
			if (cantidad && parseInt(cantidad) > 0) {
				rows.push([item.n, cantidad]);
				hayDatos = true;
			}
		});
		if (!hayDatos) {
			alert('No se ingresaron cantidades para exportar.');
			return;
		}
		let csvContent = rows.map(e => e.join(",")).join("\n");
		let blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
		let link = document.createElement('a');
		link.href = URL.createObjectURL(blob);
		link.download = 'conteo_nocturno.csv';
		document.body.appendChild(link);
		link.click();
		document.body.removeChild(link);
	}

	// Exportar a PDF (simple, usando print)
	function exportarPDF() {
		mostrarResumen();
		window.print();
	}
	// Modo oscuro CSS
	const darkModeStyle = document.createElement('style');
	darkModeStyle.innerHTML = `
	.dark-mode, .dark-mode body { background: #23272f !important; color: #e0e0e0 !important; }
	.dark-mode .container { background: #23272f !important; color: #e0e0e0 !important; }
	.dark-mode input, .dark-mode textarea, .dark-mode select { background: #23272f !important; color: #e0e0e0 !important; border-color: #444 !important; }
	.dark-mode table { background: #23272f !important; color: #e0e0e0 !important; }
	.dark-mode th, .dark-mode td { background: #23272f !important; color: #e0e0e0 !important; }
	.dark-mode #fraseMotivadora { background: #2d4a22 !important; color: #fff !important; }
	.dark-mode button { background: #4e6b4a !important; color: #fff !important; }
	.dark-mode #menuEditorModal > div { background: #23272f !important; color: #e0e0e0 !important; }
	`;
	document.head.appendChild(darkModeStyle);
	</script>
</body>
</html>
